$(function() {
    var processing = false;

    $('.pontszamitoUpdate').bind('change',function() {szamit();});

    $('#felviPontszamito button').bind('click', function(event) {
            ii = event.target.id.split('_');
	    $('#felviPontszamito select[id^=p_'+ii[1]+']').each(function(i,j) {
		x = $(j);
		x.val(ii[2]);
	    });
	    szamit();
    });

    var szamit = function() {
	var atlag = 0;
	var sum = 0;
	var count=0;
	$('.pontszamitoSelect').each(function(index,item) {
	    ertek = parseFloat($(item).val());
	    if (ertek>0) {
		sum += ertek;
		count++;
	    }
	});

	if (parseFloat($('#magyar').val()) >50) $('#magyar').val(50);
	if (parseFloat($('#matek').val()) >50) $('#matek').val(50);

	// az átlagot két tizedesre csonkoljuk... // $('#targyAtlagok').val(sum/count);
	$('#targyAtlagok').val(Math.trunc(sum/count*100)/100);
	$('#hozottPont').val(((Math.trunc(sum/count*100)/100-4)*20).toFixed(2));
//	$('#hozottPont').val(((Math.trunc(sum/count*100)/100-4)*20));
	$('#magyarSzamitott').val((parseFloat($('#magyar').val())));
	$('#matekSzamitott').val((parseFloat($('#matek').val())));

	$('#osszpont').val(
	    parseFloat($('#hozottPont').val())
	    + parseFloat($('#magyarSzamitott').val())
	    + parseFloat($('#matekSzamitott').val())
	) ;
	$('#osszszazalek').val(
	    (( parseFloat($('#hozottPont').val())
	    + parseFloat($('#magyarSzamitott').val())
	    + parseFloat($('#matekSzamitott').val())
	    ) / 120 *100).toFixed(2)
	) ;
    }

});
