$(function() {

    $('#virtualJegyEasterEgg').click(function() {  $('.virtual').remove(); $('.eeHidden').fadeToggle(); atlagSzamol(); });
    $('.addVirtualJegy').click(function() {
	var x = $(this).prev().val().split('|');
	var tipus = $(this).prev().prev().val();
	var jegy = 0;
	for(var i = x.length; i--;) {
	    var z = x[i].split('=');
	    if (z[0]=='targyId') { targyId = z[1]; }
	    if (z[0]=='jegy') { jegy = z[1]; }
	}
	if (jegy>0)
	    $(this).parent().next('td').append('<a class="eeHidden virtual jegy jegy'+tipus+'" title="" data-targyid="'+targyId+'" data-jegy="'+jegy+'" data-jegytipus="fÃ©ljegy" data-tipus="'+tipus+'"> '+parseFloat(jegy).toFixed(2)+'</a>');
	atlagSzamol();
    });

    $('#sulyozas').on('change',function() {
	atlagSzamol();
    });

    $('.jegy1').hover(function(event) {
	$('.jegy1').addClass('jegyKiemel');
    }, function(event) {
	$('.jegy1').removeClass('jegyKiemel');
    });
    $('.jegy2').hover(function(event) {
	$('.jegy2').addClass('jegyKiemel');
    }, function(event) {
	$('.jegy2').removeClass('jegyKiemel');
    });
    $('.jegy3').hover(function(event) {
	$('.jegy3').addClass('jegyKiemel');
    }, function(event) {
	$('.jegy3').removeClass('jegyKiemel');
    });
    $('.jegy4').hover(function(event) {
	$('.jegy4').addClass('jegyKiemel');
    }, function(event) {
	$('.jegy4').removeClass('jegyKiemel');
    });
    $('.jegy5').hover(function(event) {
	$('.jegy5').addClass('jegyKiemel');
    }, function(event) {
	$('.jegy5').removeClass('jegyKiemel');
    });

    $('tfoot .jegy0').click(function(event) {jegyToggleByTipus(0);});
    $('tfoot .jegy1').click(function(event) {jegyToggleByTipus(1);});
    $('tfoot .jegy2').click(function(event) {jegyToggleByTipus(2);});
    $('tfoot .jegy3').click(function(event) {jegyToggleByTipus(3);});
    $('tfoot .jegy4').click(function(event) {jegyToggleByTipus(4);});
    $('tfoot .jegy5').click(function(event) {jegyToggleByTipus(5);});

});

function jegyToggleByTipus(tipus) {
	if (tipus==0) $('tfoot .jegy0').removeClass('icon-refresh');
	else $('tfoot .jegy0').removeClass('icon-search-alt').addClass('icon-refresh');
	$.each([ 1,2,3,4,5 ], function( index, value ) {
	    if (tipus!=0 && tipus!=value) {
		$('tbody .jegy'+value).fadeOut();
	    } else {
		$('tbody .jegy'+value).fadeIn(); 
	    }
	});
}

function atlagSzamol() {
	$('.atlag').each(function(i) {
	    targyAtlagSzamol($(this).data('targyid'));
	});
}

function targyAtlagSzamol(targyid) {

    var SULYOZAS = $('#sulyozas').val().split(':');
    var jegyszam = 0;
    var jegyosszeg = 0;
    countThese = $('.jegy');
    for(var i = countThese.length; i--;) {
	elem = $(countThese[i]);
	if (elem!='undefined') { 
	    if (elem.data('targyid')==targyid) {
		jegyszam += parseInt(SULYOZAS[elem.data('tipus')-1]);
		jegyosszeg += parseFloat(elem.data('jegy'))*SULYOZAS[elem.data('tipus')-1] ;
		$('#targyAtlag_'+elem.data('targyid')).html(''+(jegyosszeg/jegyszam).toFixed(2));
	    }
	}
    }
    // if (jegyszam!=0) console.log('eredmeny:' + (jegyosszeg/jegyszam));
    return true;
}
