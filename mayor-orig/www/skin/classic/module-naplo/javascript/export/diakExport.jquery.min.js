
$(function() {

    kivalaszt = function(event) {
	$('select#kivalasztott > option').prop('selected','selected');
    }
    mezoKivalasztas = function(event) {
	optionAthelyezes('szabad','kivalasztott');
    }
    mezoTorles = function(event) {
	optionAthelyezes('kivalasztott','szabad');
    }
    optionAthelyezes = function(fromId, toId) {
	var toSel = $('#'+toId);
	if (toSel.prop('selectedIndex') == -1) {
	    $('#'+fromId+' option:selected').prop('selected','').prependTo(toSel);
	} else {
	    $('#'+fromId+' option:selected').prop('selected','').insertAfter($('#'+toId+' option:selected').first());
	}
    }
    $('.onClickMezoSelect').bind('click', function(event) {
	    element = $(event.target);
	    // Az összes elem kiválasztása...
	    kivalaszt();
	    // ... és átrakása a szabad mezők közé
	    optionAthelyezes('kivalasztott','szabad');
	    // A kiválasztandó elemek kijelölése
	    idList = $('#'+element.attr('name')+'Lista').val().split(',');
	    // és áthelyezése egyesével (a megfelelő sorrend miatt!!)
	    for (j=0; j<idList.length; j++) {
		$('#szabad option').each(function(index) {
		    if ($(this).val() == idList[j]) {
			$(this).prop('selected', 'selected');
			optionAthelyezes('szabad','kivalasztott');
			return false;
		    }
		});
	    }
    });
    includeCSS(
	"skin/classic/share/javascript/jquery-dataTables/css/jquery.dataTables.css",
	"skin/classic/share/javascript/jquery-dataTables/css/ColReorder.css"
    );
    $.getScript("skin/classic/share/javascript/jquery-dataTables/jquery.dataTables.min.js").done(function() {
      $.getScript("skin/classic/share/javascript/jquery-dataTables/jquery.dataTables.columnFilter.js").done(function() {
	$.getScript("skin/classic/share/javascript/jquery-dataTables/ColReorder.min.js").done(function() {

	    $('#diakTabla').dataTable({
    		"oLanguage": {
		    "sSearch" : "Keresés",
        	    "sLengthMenu": "Mutasson _MENU_ rekordot oldalanként",
        	    "sZeroRecords": "Nincs találat!",
        	    "sInfo": "Találatok _START_-tól _END_-ig az összesen _TOTAL_ rekordból",
        	    "sInfoEmpty": "0-tól 0-ig a 0 rekordból",
        	    "sInfoFiltered": "(szűrés nélül _MAX_ db rekord)",
		    "oPaginate": {
    			"sNext": "Következő oldal",
    			"sPrevious": "Előző oldal"
    		    }
    		},
		"sDom": 'Rlfrtip'
	    }).columnFilter();
	});
      })
    });
    $('#valaszt').bind('click', mezoKivalasztas);
    $('#torol').bind('click', mezoTorles);
    $('#exportOptions').bind('submit', kivalaszt);

});

/*
includeJS('skin/classic/share/javascript/TableFilter/tablefilter_all_min.js');
includeJS('skin/classic/share/javascript/TableFilter/sortabletable.js');
includeJS('skin/classic/share/javascript/TableFilter/tfAdapter.sortabletable.js');
Event.observe(window, 'load', myPSFLoader, false);

function myPSFLoader(evt) {

    
    // Mezőkiválasztó gombok kezelése
    var FieldSelectObject = Class.create();
    FieldSelectObject.prototype = {
        initialize: function(element) {
            this.element = $(element);
            this.element.observe('click',this.fieldSelect.bindAsEventListener(this));
        },

        fieldSelect: function(evt, extraInfo) {

	    // Az összes elem kiválasztása...
	    kivalaszt();
	    // ... és átrakása a szabad mezők közé
	    optionAthelyezes('kivalasztott','szabad');
	    // A kiválasztandó elemek kijelölése
	    this.list = $F($(this.element.getAttribute('name')+'Lista'));
	    this.idList = this.list.split(',');
	    this.options = $('szabad').options;
	    // és áthelyezése egyesével (a megfelelő sorrend miatt!!)
	    for (j=0; j<this.idList.length; j++) {
		for (i=0; i<this.options.length; i++) {
		    attr = this.options[i].value;
		    this.options[i].selected = (attr == this.idList[j]);
		}
		optionAthelyezes('szabad','kivalasztott');
	    }

            Event.stop(evt);
        }
    }

    var onClickMezoSelectElements = new Array();
    $$('.onClickMezoSelect').each(
        function (elem, index) {
            onClickMezoSelectElements.push(new FieldSelectObject(elem));
        }
    );

    // A szűrés
    if ($('diakTabla') != null) {
	var lastRowIndex = tf_Tag(tf_Id('diakTabla'),"tr").length; 
	var table1Filters = {
	    base_path: 'skin/classic/share/javascript/TableFilter/',
	    single_search_filter: false,
	    sort: true,
	    sort_config: {sort_types: []},
	    alternate_rows: true,
	    on_keyup : true,
	    highlight_keywords : true,
	    mark_active_columns: true,
	    paging: false,
	    rows_counter: true,
	    rows_counter_text: 'Találatok száma: ',
	    input_watermark: 'Keresés...',
	    filters_row_index: 1,
	    remember_grid_values: true,
	    rows_always_visible:  [lastRowIndex]
//sort_config: {sort_types: ['Number','Number','String','String','String']},
//sort_config: {sort_types: cellTypes},
//extensions: {     
//                        name:['ColumnsResizer'],   
//                        src:['TFExt_ColsResizer/TFExt_ColsResizer.js'],   
//                        description:['Columns Resizing'],   
//                        initialize:[function(o){o.SetColsResizer();}]  
//},  
//col_resizer_all_cells: true,
//editable: false,
//selectable: true,
//ezEditTable_config: {
//    default_selection: 'both',
//}
//        col_1: "select",
//        col_2: "select",
//        btn: true
	}
	if (typeof(selIndex) !== 'undefined') for (i = 0; i < selIndex.length; i++) eval('table1Filters.col_'+selIndex[i]+' = "select";');
	eval('table1Filters.col_'+cellTypes.length+' = "none";');
	if (typeof(cellTypes) !== 'undefined') table1Filters.sort_config.sort_types = cellTypes;
	var tf01 = setFilterGrid("diakTabla",1,table1Filters);
    } // van diakTabla

    Event.observe('valaszt', 'click', mezoKivalasztas);
    Event.observe('torol', 'click', mezoTorles);
    Event.observe('exportOptions', 'submit', kivalaszt);
}


/*
// A filter cseréje!
tf01.RemoveGrid();
var table1Filters = {
	single_search_filter: true,
	sort: true,
}
tf01 = new TF("diakTabla",1,table1Filters);
tf01.AddGrid();
*/
