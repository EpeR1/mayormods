/*
    TODO: összes osztály kijelölése kattintásra
*/


    $(function() {
	$('body').bind('keydown', myKeyDown);
	$('body').bind('click',function(event) {
	    var element = $(event.target);
	    if (
		$('#tanarLista').is(':visible')
		&& element.closest('#tanarLista').length == 0
		&& element.attr('id') != 'plusz'
	    ) {
			$('#tanarLista').hide();
	    }
	});
	$('#osztalyLista li input').bind('change', function(event) {
	    var element = $(event.target);
	    if (element.is(':visible')) {
		element.closest('li').toggleClass('uj');
	    }
	});
	$("#tanarok option").bind('dblclick', function(event) {
	    var elem = $(event.target);
	    if (!$("#esemenyTanar option[value='" + elem.val() + "']").length) {
		$(elem).clone().addClass('uj').appendTo( $('#esemenyTanar'));
	    }
	});
	$('#esemenyTanar').bind('dblclick', function(event) {
	    $('#tanarLista').show();
	    $('#tanarok').focus();
	});
	$('#plusz').bind('click', function(event) {
	    if ($('#tanarLista').is(':visible')) {
		selectTanar();
		$('#tanarLista').hide();
		$('#submitButton').focus();
	    } else {
		$('#tanarLista').show();
		$('#tanarok').focus();
	    }
	});
	$('#minusz').bind('click', function(event) {
	    $('#esemenyTanar option:selected').remove();
	});
	$('#add').bind('click', function(event) {
	    if ($('#tanarLista').is(':visible')) {
		selectTanar();
//		$('#tanarLista').hide();
//		$('#submitButton').focus();
	    }
	});	$('#closeTanarLista').bind('click', function(event) {
	    $('#tanarLista').hide();
	});
	$('#submitButton').bind('click',function(event) {
	    $('#esemenyTanar option').prop('selected','selected');
	});
    });

    myKeyDown = function(event) {

	var element = $(event.target);
	var charKeyCode = event.keyCode ? event.keyCode : event.which;
	var shiftKey = event.shiftKey ? event.shiftKey : ((charKeyCode == 16) ? true : false);
	var altKey = event.altKey ? event.altKey : ((charKeyCode == 18) ? true : false);
	var ctrlKey = event.ctrlKey ? event.ctrlKey : ((charKeyCode == 17) ? true : false);

	if (charKeyCode==13) { // Enter
	    if (element.attr('id') == 'tanarok') {
		selectTanar();
	    }
	} else if (charKeyCode==27) { // Esc
	    $('#tanarLista').hide();
	} else if (charKeyCode==46) { // Del
	    if (element.attr('id') == 'esemenyTanar') {
		$('#esemenyTanar option:selected').remove();
	    }
	} 
    }

    selectTanar = function() {
	$('#tanarok option:selected').each(function(index, elem) {
	    if (!$("#esemenyTanar option[value='" + $(elem).val() + "']").length) {
		$(elem).clone().addClass('uj').appendTo( $('#esemenyTanar'));
	    }
	});
    }

