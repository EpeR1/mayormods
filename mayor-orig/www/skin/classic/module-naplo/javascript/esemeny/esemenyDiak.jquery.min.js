

    $(function() {
	$('body').bind('keydown', myKeyDown);
	$('input.plusz').bind('click', function(event) {
	    var element = $(event.target);
    	    var container = element.parents('table');
    	    var openable  = container.find('.openable').hide();
    	    var onclickshow = container.find('.plusz').removeClass('selected');
    	    var id = element[0].id;
    	    if (id && id.substring(0,4) == 'show') {
        	var openable = '#'+id.charAt(4).toLowerCase()+ id.substring(5);
        	$(openable).show();
		setTimeout(function() { // várni kell, hogy láthatóvá váljon a select, csak utána lehet fokuszt adni rá
		    $(openable+' select').focus();
		}, 1);
    	    }
    	    element.addClass('selected');

	});
	$('input.add').bind('click', function(event) {
	    var selectElement = $(event.target).prev('select');
	    selectDiak(selectElement);	    
	});
	$("select.diakok option").bind('dblclick', function(event) {
	    var selectElement = $(event.target).closest('select');
	    selectDiak(selectElement);
	});
	$('#nevsor').click(function(event) {
	    elem = $(event.target);
	    if (elem.hasClass('removeLine')) {
		elem.closest('tr').remove();
	    } else if (elem.hasClass('icon-remove-sign')) {
    		if (!confirm(elem.prop('title'))) {
            	    event.preventDefault();
        	} else {
		// töröl
		    $('#postDiakId').attr('name','torolDiakId').val(elem.find('input').val());
		    elem.closest('form').submit();
		}
	    } else if (elem.hasClass('icon-ok-sign')) {
		// jóváhagyást elutasít
		    $('#postDiakId').attr('name','elutasitDiakId').val(elem.closest('tr').find('input').val());
		    elem.closest('form').submit();
	    } else if (elem.hasClass('icon-minus-sign')) {
		// jóváhagy
		    $('#postDiakId').attr('name','jovahagyDiakId').val(elem.closest('tr').find('input').val());
		    elem.closest('form').submit();
	    }
	});
	$('#nevsor td.osztaly').bind('click', function(event) {
	    elem = $(event.target);
	    _class = elem.text().replace('.','');
	    $('#nevsor tr').not('.'+_class).toggle();
	});
    });

    myKeyDown = function(event) {

	var element = $(event.target);
	var charKeyCode = event.keyCode ? event.keyCode : event.which;
	var shiftKey = event.shiftKey ? event.shiftKey : ((charKeyCode == 16) ? true : false);
	var altKey = event.altKey ? event.altKey : ((charKeyCode == 18) ? true : false);
	var ctrlKey = event.ctrlKey ? event.ctrlKey : ((charKeyCode == 17) ? true : false);

	if (charKeyCode==13) { // Enter
	    if (element.hasClass('diakok')) {
		selectDiak(element);
            	event.preventDefault();
	    }
	} else if (charKeyCode==27) { // Esc
	    $('form#nevsorForm .openable').hide();
	    $('form#nevsorForm #oEmpty').show();
	} else if (charKeyCode==9) { // Tab
	    if (element.hasClass('diakok')) {
		if ($('#osztalyok input.selected').nextAll('input:first').length) {
		    $('#osztalyok input.selected').nextAll('input:first').click();
		} else {
		    $('#osztalyok input:first').click();
		}
	    }
	}
    }

    function selectDiak(selectElement) {

	selectElement.find('option:selected').each(function(index, elem) {
	    if (!$("#nevsor input[value='" + $(elem).val() + "']").length) {
		var sor='<tr class="ujDiak">'
		+'<td class="sorsz"><input type="hidden" name="ujDiakId[]" value="'+$(elem).val()+'" /></td>'
		+'<td><span class="icon-remove-sign removeLine"></span></td>'
		+'<td class="nev">'+$(elem).text()+'</td>'
		+'<td class="jelDt"></td>'
		+'<td class="jovDt" colspan="2"></td>'
		+'<tr>';
		$(sor).insertBefore($('#submitRow'));
//		$(sor).appendTo($('#nevsor'));
	    }
	});
    }

