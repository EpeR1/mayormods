var debug=false;
$(function() {

    $('body').bind('submit', mayorNaploSubmitSearch);

    $('.toolBarClear').click(function(event) {
	var element = $(event.target);
	element.closest('table').find('select').prop('selectedIndex',0);
	element.closest('table').find('form').submit();
    });

    $('.btnSelectNext').on('click',function(event) {
	var selectTool = $(this).prev('select'); // közvetlenül az előtte levő elem (select)
	$(selectTool).find('option:selected').removeAttr('selected').next('option').attr('selected', 'selected');
	$(selectTool).change();
    });
    $('.btnSelectPrev').on('click',function(event) {
	var selectTool = $(this).next('select'); // közvetlenül a mögötte levő elem (select)
	$(selectTool).find('option:selected').removeAttr('selected').prev('option').attr('selected', 'selected');
	$(selectTool).change();
    });

    $('#toolBarHamburgerVezerlo').click(function(event) {
	$('#toolBarHamburgerLista').toggle();
    });

//    if ($('#diakSelectLista option').length == 0){
        $('#diakSelectPattern').closest('form').submit( function(event) {
	    var $form = $(this);
	    if ($('#diakSelectLista').val()=="") {
		$form.data('submitted',false);
		return false;
	    }
	});
	$('#diakSelectIcon').click( function(event) {
		    $('#diakSelectPattern').toggle().focus();
		    //$('#diakSelectIcon').toggle();
		    $('#diakSelectLista').toggle().prop('selectedIndex',0);
	});
        $('#diakSelectPattern').change( function(event) {
	    var pattern = $('#diakSelectPattern').val();
	    // we need to catch ENTER!
            var params = $.parseParams(window.location.toString().split('?')[1] || '' );
            var sessionID=params.sessionID?params.sessionID:'';
	    $.ajax({
		type: "POST",
		url: "?page=naplo&sub=tools&f=kereso&policy=private&skin=ajax&sessionID="+sessionID,
		data: { 'pattern': pattern, 'tipus':'diak', 'sessionID':sessionID },
		dataType: 'json'
	    }).done(function( msg ) {
		var listItems = $('#diakSelectLista');
		var D = msg[0]['diakok']; // vajon miért így kell erre hivatkozni?
		if (D.length>0) {
		    listItems.find('option').remove();
		    listItems.find('optgroup').remove();
		    listItems.append('<option value=""></option>');
		    for (i=0; i<D.length; i++) {
			listItems.append('<option value="'+D[i]['diakId']+'">'+D[i]['diakNev']+'</option>');
		    }
		    $('#diakSelectPattern').hide();
		    $('#diakSelectIcon').show();
		    $('#diakSelectLista').show().focus();
		    if (D.length==1) {
			//$("#diakSelectLista").val($("#diakSelectLista option:last").attr('selected',true));
			$("#diakSelectLista option:last").attr('selected',true);
			$('#diakSelectTool').submit();
		    }
		}
	    });
	});
//    }



/*
    $(document).on('click', '.oraErtekel', function(event) {
        element = $(event.target);
	var elementData = element.data();
	var ID = '';
	if ( elementData.hasOwnProperty('oraid')==true ) {
    	    ajaxSetOraLike(element.data('oraid'),element.data('jovolt'));
	}
    });
*/
    $(document).on('click', '.jegyAdat', function(event) {
        element = $(event.target);
	var elementData = element.data();
	var ID = '';
	if ( elementData.hasOwnProperty('jegyid')==true ) {
    	    ajaxGetJegyAdat(element.data('jegyid'));
	}
    });

    $(document).on('click', '.zaroJegyAdat', function(event) {
        element = $(event.target);
	var elementData = element.data();
	var ID = '';
	if ( elementData.hasOwnProperty('zarojegyid')==true ) {
    	    ajaxGetZaroJegyAdat(element.data('zarojegyid'));
	}
    });

    $(document).on('click', '.tankorAdat', function(event) {
        element = $(event.target);
	var elementData = element.data();
	var ID = '';
	if ( elementData.hasOwnProperty('tankorid')==true ) {
    	    ID = element.data('tankorid');
	} else if ( $(this).data().hasOwnProperty('tankorid')==true ) {
    	    ID = $(this).data('tankorid');
	}
    	if (ID!='') ajaxGetTankorAdat(ID);
	
    });

    $(document).on('click', '.osztalyAdat', function(event) {
        element = $(event.target);
	var elementData = element.data();
	var ID = '';
	if ( elementData.hasOwnProperty('osztalyid')==true ) {
    	    ID = (element.data('osztalyid'));
	} else if ( $(this).data().hasOwnProperty('osztalyid')==true ) {
    	    ID = $(this).data('osztalyid');
	}
    	if (ID!='') ajaxGetOsztalyAdat(ID);
    });

    mayorNaploEventHandlers();

});

mayorNaploSubmitSearch = function (event) {

    var element = $(event.target);
    if (element.attr('id') == 'mayorSearch') {
        var pattern = $('#mayorSearch input[type=text]').val();
	var postData = { 'tipus':'diak','pattern': pattern, 'strict':1, 'mayorToken': ($('body').data('mayortoken')) };
	$.ajax({
                    type: "POST",
                    url: "index.php?page=naplo&sub=tools&f=kereso&policy=private&skin=ajax&sessionID="+$('body').data('sessionid'),
                    data: postData,
                    dataType: 'json'
	}).done(function( msg, status, jqXHR ) {
    		    processJSONKeresoDiakAdat(msg);
            	    updateSalt(jqXHR.getResponseHeader('Etag'));
		    mayorNaploEventHandlers();
	}).fail(function( jqXHR, textStatus, errorThrown ) {
                    //console.log(jqXHR);
	});

	var postData = { 'tipus':'tanar','pattern': pattern, 'strict':1, 'mayorToken': ($('body').data('mayortoken')) };
	$.ajax({
                    type: "POST",
                    url: "index.php?page=naplo&sub=tools&f=kereso&policy=private&skin=ajax&sessionID="+$('body').data('sessionid'),
                    data: postData,
                    dataType: 'json'
	}).done(function( msg, status, jqXHR ) {
    		    processJSONKeresoTanarAdat(msg);
            	    updateSalt(jqXHR.getResponseHeader('Etag'));
		    mayorNaploEventHandlers();
	}).fail(function( jqXHR, textStatus, errorThrown ) {
                    //console.log(jqXHR);
	});

	var postData = { 'tipus':'szulo','pattern': pattern, 'strict':1, 'mayorToken': ($('body').data('mayortoken')) };
	$.ajax({
                    type: "POST",
                    url: "index.php?page=naplo&sub=tools&f=kereso&policy=private&skin=ajax&sessionID="+$('body').data('sessionid'),
                    data: postData,
                    dataType: 'json'
	}).done(function( msg, status, jqXHR ) {
    		    processJSONKeresoSzuloAdat(msg);
            	    updateSalt(jqXHR.getResponseHeader('Etag'));
		    mayorNaploEventHandlers();
	}).fail(function( jqXHR, textStatus, errorThrown ) {
                    //console.log(jqXHR);
	});



    }

}

processJSONKeresoDiakAdat = function( ADAT ) {
//        console.log(JSON.stringify(ADAT));
//        $('#updateWindowSide').addClass('nyitva');
//        $('#updateWindowSideTitle').html(diakAdat['diakNev']);
//	$('#mayorSearch').remove();
        var content = '';
	if (ADAT['diakok'].length>0) {
	    for (i=0; i<ADAT['diakok'].length; i++) {
		var a = ADAT['diakok'][i];
		//content += '<div style="display:block;">';
		content += '<a class="diakNev" data-diakid="'+a['diakId']+'" href="" onclick="return false;">'+a['diakNev']
		if (a['osztalyJel']!=null) content += ' ('+a['osztalyJel']+')';
		content +='</a>';
		//content += '<span class="icon-envelope"></span>';
		//content += '</div>';
	    }
	    $('#mayorSearch').append(content);
	}
}
processJSONKeresoTanarAdat = function( ADAT ) {
        var content = '';
	if (ADAT['tanarok'].length>0) {
	    for (i=0; i<ADAT['tanarok'].length; i++) {
		var a = ADAT['tanarok'][i];
		content += '<a class="tanarNev" data-tanarid="'+a['tanarId']+'" href="" onclick="return false;">'+a['tanarNev']+'</a>';
	    }
	    $('#mayorSearch').append(content);
	}
}
processJSONKeresoSzuloAdat = function( ADAT ) {
        var content = '';
	if (ADAT['szulok'].length>0) {
	    for (i=0; i<ADAT['szulok'].length; i++) {
		var a = ADAT['szulok'][i];
		content += '<a class="szuloNev" data-szuloid="'+a['szuloId']+'" href="" onclick="return false;">'+a['szuloNev']+'</a>';
	    }
	    $('#mayorSearch').append(content);
	}

}


ajaxGetDiakAdat = function(diakId) {
    postData = { 'diakId':diakId, 'mayorToken': ($('body').data('mayortoken')) }
    $.ajax({
                    type: "POST",
                    url: "index.php?page=naplo&sub=tools&f=getDiakAdat&policy=private&skin=ajax&sessionID="+$('body').data('sessionid'),
                    data: postData,
                    dataType: 'json'
    }).done(function( msg, status, jqXHR ) {
                    processJSONDiakAdat(msg);
            	    updateSalt(jqXHR.getResponseHeader('Etag'));
		    mayorNaploEventHandlers();
    }).fail(function( jqXHR, textStatus, errorThrown ) {
                    //console.log(jqXHR);
    });
}

ajaxGetSzuloAdat = function(szuloId) {
    postData = { 'szuloId':szuloId, 'mayorToken': ($('body').data('mayortoken')) }
    $.ajax({
                    type: "POST",
                    url: "index.php?page=naplo&sub=tools&f=getSzuloAdat&policy=private&skin=ajax&sessionID="+$('body').data('sessionid'),
                    data: postData,
                    dataType: 'json'
    }).done(function( msg, status, jqXHR ) {
                    processJSONSzuloAdat(msg);
            	    updateSalt(jqXHR.getResponseHeader('Etag'));
		    mayorNaploEventHandlers();
    }).fail(function( jqXHR, textStatus, errorThrown ) {
                    //console.log(jqXHR);
    });
}

ajaxGetTanarAdat = function(tanarId) {
    postData = { 'tanarId':tanarId, 'mayorToken': ($('body').data('mayortoken')) }
    $.ajax({
                    type: "POST",
                    url: "index.php?page=naplo&sub=tools&f=getTanarAdat&policy=private&skin=ajax&sessionID="+$('body').data('sessionid'),
                    data: postData,
                    dataType: 'json'
    }).done(function( msg, status, jqXHR ) {
                    processJSONTanarAdat(msg);
            	    updateSalt(jqXHR.getResponseHeader('Etag'));
		    mayorNaploEventHandlers();
    }).fail(function( jqXHR, textStatus, errorThrown ) {
		    //console.log('hiba történt!'+textStatus);
                    //console.log(jqXHR);
    });
}

ajaxGetTankorAdat = function(tankorId) {
    postData = { 'tankorId':tankorId, 'mayorToken': ($('body').data('mayortoken')) }
    $.ajax({
                    type: "POST",
                    url: "index.php?page=naplo&sub=tools&f=getTankorAdat&policy=private&skin=ajax&sessionID="+$('body').data('sessionid'),
                    data: postData,
                    dataType: 'json'
    }).done(function( msg, status, jqXHR ) {
                    processJSONTankorAdat(msg);
            	    updateSalt(jqXHR.getResponseHeader('Etag'));
		    mayorNaploEventHandlers();
    }).fail(function( jqXHR, textStatus, errorThrown ) {
		    //console.log('hiba történt!'+textStatus);
                    //console.log(jqXHR);
    });
}
ajaxGetOsztalyAdat = function(osztalyId) {
    postData = { 'osztalyId':osztalyId, 'mayorToken': ($('body').data('mayortoken')) }
    $.ajax({
                    type: "POST",
                    url: "index.php?page=naplo&sub=tools&f=getOsztalyAdat&policy=private&skin=ajax&sessionID="+$('body').data('sessionid'),
                    data: postData,
                    dataType: 'json'
    }).done(function( msg, status, jqXHR ) {
                    processJSONOsztalyAdat(msg);
            	    updateSalt(jqXHR.getResponseHeader('Etag'));
		    mayorNaploEventHandlers();
    }).fail(function( jqXHR, textStatus, errorThrown ) {
		    //console.log('hiba történt!'+textStatus);
                    //console.log(jqXHR);
    });
}

ajaxGetDolgozatAdat = function(dolgozatId) {
    postData = { 'dolgozatId': dolgozatId, 'mayorToken': ($('body').data('mayortoken')) }
    $.ajax({	    type: "POST",
                    url: "index.php?page=naplo&sub=tools&f=dolgozatAdat&policy=private&skin=ajax&sessionID="+$('body').data('sessionid'),
                    data: postData,
                    dataType: 'json'
    }).done(function( msg, status, jqXHR ) {
                    processJSONDolgozatAdat(msg);
            	    updateSalt(jqXHR.getResponseHeader('Etag'));
		    mayorNaploEventHandlers();
    }).fail(function( jqXHR, textStatus, errorThrown ) {
		    alert('Valami hiba történt');
		    //console.log('hiba történt!'+textStatus);
                    //console.log(jqXHR);
    });
}

ajaxGetJegyAdat = function(jegyId) {
    postData = { 'jegyId':jegyId, 'mayorToken': ($('body').data('mayortoken')) }
    $.ajax({
                    type: "POST",
                    url: "index.php?page=naplo&sub=tools&f=getJegyAdat&policy=private&skin=ajax&sessionID="+$('body').data('sessionid'),
                    data: postData,
                    dataType: 'json'
    }).done(function( msg, status, jqXHR ) {
                    processJSONJegyAdat(msg);
            	    updateSalt(jqXHR.getResponseHeader('Etag'));
		    mayorNaploEventHandlers();
    }).fail(function( jqXHR, textStatus, errorThrown ) {
                    //console.log(jqXHR);
    });
}
ajaxGetZaroJegyAdat = function(zaroJegyId) {
    postData = { 'zaroJegyId':zaroJegyId, 'mayorToken': ($('body').data('mayortoken')) }
    $.ajax({
                    type: "POST",
                    url: "index.php?page=naplo&sub=tools&f=getZaroJegyAdat&policy=private&skin=ajax&sessionID="+$('body').data('sessionid'),
                    data: postData,
                    dataType: 'json'
    }).done(function( msg, status, jqXHR ) {
                    processJSONZaroJegyAdat(msg);
            	    updateSalt(jqXHR.getResponseHeader('Etag'));
		    mayorNaploEventHandlers();
    }).fail(function( jqXHR, textStatus, errorThrown ) {
                    //console.log(jqXHR);
    });
}


ajaxGetOraAdat = function(oraId) {

    postData = { 'oraId':oraId, 'mayorToken': ($('body').data('mayortoken')) }
    $.ajax({
                    type: "POST",
                    url: "index.php?page=naplo&sub=tools&f=getOraAdat&policy=private&skin=ajax&sessionID="+$('body').data('sessionid'),
                    data: postData,
                    dataType: 'json'
    }).done(function( msg, status, jqXHR ) {
                    processJSONOraAdat(msg);
            	    updateSalt(jqXHR.getResponseHeader('Etag'));
		    mayorNaploEventHandlers();
    }).fail(function( jqXHR, textStatus, errorThrown ) {
		    //console.log('hiba történt!'+textStatus);
                    //console.log(jqXHR);
    });
}
ajaxGetNapAdat = function(napDt) {
    postData = { 'napDt': napDt, 'mayorToken': ($('body').data('mayortoken')) }
    $.ajax({
                    type: "POST",
                    url: "index.php?page=naplo&sub=tools&f=napAdat&policy=private&skin=ajax&sessionID="+$('body').data('sessionid'),
                    data: postData,
                    dataType: 'json'
    }).done(function( msg, status, jqXHR ) {
                    processJSONNapAdat(msg);
            	    updateSalt(jqXHR.getResponseHeader('Etag'));
		    mayorNaploEventHandlers();
    }).fail(function( jqXHR, textStatus, errorThrown ) {
		    //console.log('hiba történt!'+textStatus);
                    //console.log(jqXHR);
    });
}

ajaxGetJegyzetAdat = function(jegyzetId,refJegyzetDt) {
    postData = { 'jegyzetId':jegyzetId, 'refJegyzetDt':refJegyzetDt, 'mayorToken': ($('body').data('mayortoken')) }
    $.ajax({
                    type: "POST",
                    url: "index.php?page=naplo&sub=tools&f=jegyzetAdat&policy=private&skin=ajax&sessionID="+$('body').data('sessionid'),
                    data: postData,
                    dataType: 'json'
    }).done(function( msg, status, jqXHR ) {
        	    processJSONJegyzetAdat(msg);
            	    updateSalt(jqXHR.getResponseHeader('Etag'));
		    mayorNaploEventHandlers();
    }).fail(function( jqXHR, textStatus, errorThrown ) {
		    //console.log('hiba történt!'+textStatus); console.log(jqXHR);
            	    updateSalt(jqXHR.getResponseHeader('Etag'));
    });
}

ajaxSetOraAdat = function(adat) {
    postData = adat;
    $.ajax({
                    type: "POST",
                    url: "index.php?page=naplo&sub=tools&f=getOraAdat&policy=private&skin=ajax&sessionID="+$('body').data('sessionid'),
                    data: postData,
                    dataType: 'json'
    }).done(function( msg, status, jqXHR ) {
                    processJSONOraAdat(msg);
//		    updateOraAdat(msg.adat);
            	    updateSalt(jqXHR.getResponseHeader('Etag'));
		    mayorNaploEventHandlers();
    }).fail(function( jqXHR, textStatus, errorThrown ) {
		    //console.log('hiba történt!'+textStatus); console.log(jqXHR);
            	    updateSalt(jqXHR.getResponseHeader('Etag'));
		    alert('Sajnos valami hiba történt! Próbáld újra! '+textStatus);
    });
}

ajaxSetJegyzetAdat = function(adat) {
    postData = adat;
    $.ajax({
                    type: "POST",
                    url: "index.php?page=naplo&sub=tools&f=jegyzetAdat&policy=private&skin=ajax&sessionID="+$('body').data('sessionid'),
                    data: postData,
                    dataType: 'json'
    }).done(function( msg, status, jqXHR ) {
                    processJSONJegyzetAdat(msg);
		    updateJegyzet(msg.adat);
            	    updateSalt(jqXHR.getResponseHeader('Etag'));
		    mayorNaploEventHandlers();
    }).fail(function( jqXHR, textStatus, errorThrown ) {
		    //console.log('hiba történt!'+textStatus); console.log(jqXHR);
            	    updateSalt(jqXHR.getResponseHeader('Etag'));
		    alert('Sajnos valami hiba történt! Próbáld újra! '+textStatus);
    });
}

ajaxDelJegyzet = function(adat) {
    postData = adat;
    $.ajax({
                    type: "POST",
                    url: "index.php?page=naplo&sub=tools&f=jegyzetAdat&policy=private&skin=ajax&sessionID="+$('body').data('sessionid'),
                    data: postData,
                    dataType: 'json'
    }).done(function( msg, status, jqXHR ) {
		    removeJegyzet(msg);
            	    updateSalt(jqXHR.getResponseHeader('Etag'));
		    mayorNaploEventHandlers();
    }).fail(function( jqXHR, textStatus, errorThrown ) {
		    //console.log('hiba történt!'+textStatus); console.log(jqXHR);
            	    updateSalt(jqXHR.getResponseHeader('Etag'));
		    alert('Sajnos valami hiba történt! Próbáld újra! '+textStatus);
    });
}

// --------------------------------------------------------------

processJSONDiakAdat = function( diakAdat ) {

	//if (diakAdat.visibleData != true) return false;
        var content = '';
	content += '<div id="mayorNaviIconHolder">';
	content += '<div class="mayorNaviIcon"><a href="'+href({'page':'naplo','sub':'orarend','f':'orarend','diakId':diakAdat['diakId']})+'"><span class="icon-th"></span><br/>Órarend</a></div>';
	content += '<div class="mayorNaviIcon"><a href="'+href({'page':'naplo','sub':'intezmeny','f':'diakTankor','diakId':diakAdat['diakId']})+'"><span class="icon-group-alt"></span><br/>Tankörök</a></div>';
	content += '<div class="mayorNaviIcon"><a href="'+href({'page':'naplo','sub':'hianyzas','f':'diak','diakId':diakAdat['diakId']})+'"><span class="icon-calendar-sign"></span><br/>Hiányzások</a></div>';
	content += '<div class="mayorNaviIcon"><a href="'+href({'page':'naplo','sub':'osztalyozo','f':'diak','diakId':diakAdat['diakId']})+'"><span class="icon-pencil-alt"></span><br/>Jegyek</a></div>';
//	content += '<div class="mayorNaviIcon"><a href="'+href({'page':'naplo','sub':'uzeno','f':'uzeno','diakId':diakAdat['diakId']})+'"><span class="icon-envelope"></span><br/>Üzenő</a></div>';
	content += '<div class="mayorNaviIcon"><a href="'+href({'page':'naplo','sub':'hirnok','f':'hirnok','diakId':diakAdat['diakId']})+'"><span class="icon-bullhorn"></span><br/>Hírnök</a></div>';
	content += '</div>';

    if (diakAdat['diakOsztaly']!=undefined) {
        content += '<h3><a href="'+  href({'page':'naplo','sub':'intezmeny','f':'osztaly','diakId':diakAdat['diakId']}) +'">Osztály ('+diakAdat['tanev']+')</a></h3>';
        content += '<ul>';
	if (diakAdat['diakJogviszony']!=undefined)
        for (i=0; i<diakAdat['diakOsztaly'].length; i++) {
            var _osztalyAdat = diakAdat['osztalyAdat'][diakAdat['diakOsztaly'][i]['osztalyId']];
            content += '<li>'
    		+ '<a href="'+  href({'page':'naplo','sub':'intezmeny','f':'osztaly','osztalyId':_osztalyAdat['osztalyId']}) +'">'
		+ (_osztalyAdat['osztalyJel']) + " "
//                + _osztalyAdat['kezdoTanev'] + '-' + _osztalyAdat['vegzoTanev'] + '/' + _osztalyAdat['jel']
//                + ' (' + _osztalyAdat['osztalyId'] + ') '
                + diakAdat['diakOsztaly'][i]['beDt'] + ' - '
                + ((diakAdat['diakOsztaly'][i]['kiDt'] == null) ? '...':diakAdat['diakOsztaly'][i]['kiDt'])
                + '</a></li>';
        }
        content += '</ul>';
    }
	if (diakAdat['diakKepzes']!=undefined)
	if (diakAdat['diakKepzes'].length>0) {
	    content += '<h3>Képzések</h3>';
	    content += '<ul>';
	    for (i=0; i<(diakAdat['diakKepzes'].length); i++) {
		content += '<li>'+diakAdat['diakKepzes'][i]['kepzesNev']+ ' ' + diakAdat['diakKepzes'][i]['tolDt']+'–'+diakAdat['diakKepzes'][i]['igDt']+'</li>';
	    }
	    content += '</ul>';
	}

        content += '<h3><a href="'+  href({'page':'naplo','sub':'intezmeny','f':'diakStatusz','diakId':diakAdat['diakId']}) +'">Jogviszony</a></h3>';
        content += '<ul>';
	if (diakAdat['diakJogviszony']!=undefined)
        for (i=0; i<diakAdat['diakJogviszony'].length; i++) {
            content += '<li>' +diakAdat['diakJogviszony'][i]['statusz'] + ', ' + diakAdat['diakJogviszony'][i]['dt'] + '</li>';
        }
        content += '</ul>';
    
	if (diakAdat['diakFelmentes']!=undefined)
        if (diakAdat['diakFelmentes'].length>0) {
            content += "<h3>Felmentések ("+diakAdat['tanev']+")</h3>";
            content += '<ul>';
            for (i=0; i<diakAdat['diakFelmentes'].length; i++) {
                var d = diakAdat['diakFelmentes'][i];
                content += '<li>'
                    + d['felmentesTipus'] + " "
                    + diakAdat['diakTankorAssoc'][d['tankorId']]['tankorNev'] + "<br/>"
                    + d['beDt'] + ' - ' + d['kiDt'] + " "
                    + "nap: "+d['nap'] + " "
                    + "óra: "+d['ora'] + " "
                + '</li>';
            }
            content += '</ul>';
        }
        content += '<h3><a href="'+  href({'page':'naplo','sub':'intezmeny','f':'diakTankor','diakId':diakAdat['diakId']}) +'">Tankörök ('+diakAdat['tanev']+')</a></h3>';
        content += '<ul>';
	if (diakAdat['diakTankor']!=undefined)
        for (i=0; i<diakAdat['diakTankor'].length; i++) {
            content += '<li class="tankorAdat" data-tankorid="'+diakAdat['diakTankor'][i]['tankorId']+'">' +diakAdat['diakTankor'][i]['tankorNev'] + ' (' + diakAdat['diakTankor'][i]['kovetelmeny'] + ')</li>';
        }
        content += '</ul>';
        content += '<h3><a href="'+  href({'page':'naplo','sub':'intezmeny','f':'diak','diakId':diakAdat['diakId']}) +'">Egyéb</a></h3>';
        content += '<ul>';
            if (diakAdat['szuletesiHely'] != null) content += '<li>Született: ' +diakAdat['szuletesiHely'] + ', ' + diakAdat['szuletesiIdo'] +' <span class="diakEletkor">'+ diakAdat['diakEletkor'] + '</span></li>';
            if (diakAdat['torzslapszam'] != null) content += '<li>Törzslapszám: ' +diakAdat['torzslapszam'] + '</li>';
            if (diakAdat['mobil'] != null) content += '<li>Telefon: ' +diakAdat['mobil'] + '</li>';
            if (diakAdat['email'] != null) content += '<li>E-mail: ' +diakAdat['email'] + '</li>';
	    content += '<li>Lakik: ' +diakAdat['lakhelyIrsz'] + ' '
		+diakAdat['lakhelyHelyseg'] + ', '
		+diakAdat['lakhelyKozteruletNev'] + ' '
		+diakAdat['lakhelyKozteruletJelleg'] + ' '
		+diakAdat['lakhelyHazszam'] 
	    + '</li>';
	    if (diakAdat['megjegyzes'] != null) content += '<li>Megjegyzés: ' + diakAdat['megjegyzes'] +'</li>';
        content += '</ul>';
        content += "<h3>Szülei</h3>";
        content += '<ul>';
	    if (diakAdat['diakSzulo']!=undefined)
    	    for (i=0; i<diakAdat['diakSzulo'].length; i++) {
                var d = diakAdat['diakSzulo'][i];
                content += '<li>';
		    //content += '<a href="'+  href({'page':'naplo','sub':'intezmeny','f':'diakSzulo','diakId':diakAdat['diakId'],'szuloId':d['szuloId']}) +'">';
		    content += '<span class="szuloNev" data-szuloid="'+d['szuloId']+'">';
		    content += d['szuloNev'];
		    content += '</span>';
//		    if (d['szuleteskoriNev']!=null) content += ' ('+d['szuleteskoriNev']+')'; 
		content += '</li>';
	    }
        content += '</ul>';

	content += '<span style="display:none" id="mayorsidewindowtype" data-mayorsidewindowtype="diak"></span>';
	if (    $('#updateWindowSide').hasClass('nyitva') ==true && $('#mayorsidewindowtype').data('mayorsidewindowtype')!='diak' ) {
    	    $('#updateWindowSideSubTitle').html('<a href="'+href({'page':'naplo','sub':'intezmeny','f':'diak','diakId':diakAdat['diakId']})+'">'+diakAdat['diakNev']+'</a>');
    	    $('#updateWindowSideSubContent').html(content);
    	    $('#updateWindowSideSub').addClass('nyitva');
	} else {
    	    $('#updateWindowSideTitle').html('<a href="'+href({'page':'naplo','sub':'intezmeny','f':'diak','diakId':diakAdat['diakId']})+'">'+diakAdat['diakNev']+'</a>');
    	    $('#updateWindowSideContent').html(content);
    	    $('#updateWindowSide').addClass('nyitva');
	}


}

processJSONTanarAdat = function( adat ) {
//        console.log(JSON.stringify(adat));
        var content = '';
	content += '<div id="mayorNaviIconHolder">';
	content += '<div class="mayorNaviIcon"><a href="'+href({'page':'naplo','sub':'orarend','f':'orarend','tanarId':adat['tanarId']})+'"><span class="icon-th"></span><br/>Órarend</a></div>';
	if (adat.layerPolicy>0) {
	    content += '<div class="mayorNaviIcon"><a href="'+href({'page':'naplo','sub':'haladasi','f':'haladasi','tanarId':adat['tanarId']})+'"><span class="icon-file-edit-alt"></span><br/>Haladási</a></div>';
	    content += '<div class="mayorNaviIcon"><a href="'+href({'page':'naplo','sub':'hianyzas','f':'ora','tanarId':adat['tanarId']})+'"><span class="icon-calendar-sign"></span><br/>Hiányzások</a></div>';
	    content += '<div class="mayorNaviIcon"><a href="'+href({'page':'naplo','sub':'osztalyozo','f':'tankor','tanarId':adat['tanarId']})+'"><span class="icon-pencil-alt"></span><br/>Osztályozó</a></div>';
	    content += '<div class="mayorNaviIcon"><a href="'+href({'page':'naplo','sub':'hirnok','f':'hirnok','tanarId':adat['tanarId']})+'"><span class="icon-bullhorn"></span><br/>Hírnök</a></div>';
	} else {
    	    content += '<div class="mayorNaviIcon"><a href="'+href({'page':'naplo','sub':'uzeno','f':'uzeno','tanarId':adat['tanarId']})+'"><span class="icon-envelope"></span><br/>Üzenő</a></div>';

	}
	content += '</div>';
//
//        content += '<h3><a href="'+  href({'page':'naplo','sub':'intezmeny','f':'osztaly','diakId':adat['diakId']}) +'">Osztály ('+adat['tanev']+')</a></h3>';

//	content += '<h3>Mai órák</h3>';	
//	content += adat['maiOrak']['html'];

/* 
        content += '<h3>Óraterhelés</h3>';
//	oraTerheles":{"56":{"munkaido":{"heti":40,"kotott":32,"lekotott":26},"ossz":{"heti":"13","napi":"4"},"kotottEloirt":{"heti":"13","napi":"4"},"kotott":{"heti":"13","napi":"4"},"lekotott":{"heti":"13","napi":"4"}}}}
	var OT = adat['oraTerheles'][adat['tanarId']];
	content += '<ul>';
	content += '<li>Heti munkaidő referencia: '+ OT['munkaido']['heti'] + '-' + OT['munkaido']['kotott'] + '-' + OT['munkaido']['lekotott'];
	content += '</li><li>Össz: '+ OT['ossz']['heti'] + '|' + OT['ossz']['napi'];
	content += '</li><li>Kötött: '+ OT['kotott']['heti'] + '|' + OT['kotott']['napi'];
	content += '</li><li>Kötött-előírt: '+ OT['kotottEloirt']['heti'] + '|' + OT['kotottEloirt']['napi'];
	content += '</li><li>Lekötött: '+ OT['lekotott']['heti'] + '|' + OT['lekotott']['napi'];
	content += '</li>';
	content += '</ul>';
*/

	if(adat.layerPolicy>0) {
	    if (adat.tanarTankor!=undefined) {
		content += '<h3>Tanár tankörei</h3>';
		content += '<ul>';
		for (i=0; i<adat.tanarTankor.length; i++) {
		 content += '<li><span class="tankorAdat" data-tankorid="'+adat.tanarTankor[i]['tankorId']+'">'
		    +adat.tanarTankor[i].tankorNev+'</span></li>';
		}
		content += '</ul>';
	    }

	    content += '<h3>Egyéb adatok</h3>';
	    content += '<ul>';
	    if (adat['beDt']!='') content += '<li>Munkaviszony: '+adat['beDt']+ (adat['kiDt']==null?'':' – '+adat['kiDt']) +'</li>';
	    if (adat['hetiMunkaora']!='') content += '<li>Heti munkaóra: '+adat['hetiMunkaora']+'</li>';
	    if (adat['hetiKotelezoOraszam']!='') content += '<li>Heti kötelező óraszám: '+adat['hetiKotelezoOraszam']+'</li>';
	    if (adat['statusz']!='') content += '<li>Státusz: '+adat['statusz']+'</li>';
	    if (adat['besorolas']!='') content += '<li>Besorolás: '+adat['besorolas']+'</li>';
	    if (adat['tovabbkepzesForduloDt']!='') content += '<li>Továbbképzés forduló dátum: '+adat['tovabbkepzesForduloDt']+'</li>';
	    content += '</ul>';
	}
	content += '<span style="display:none" id="mayorsidewindowtype" data-mayorsidewindowtype="tanar"></span>';
	if (    $('#updateWindowSide').hasClass('nyitva') ==true && $('#mayorsidewindowtype').data('mayorsidewindowtype')!='tanar' ) {
    	    $('#updateWindowSideSubTitle').html('<a href="'+href({'page':'naplo','sub':'intezmeny','f':'tanar','tanarId':adat['tanarId']})+'">'+adat['tanarNev']+'</a>');
    	    $('#updateWindowSideSubContent').html(content);
    	    $('#updateWindowSideSub').addClass('nyitva');
	} else {
    	    $('#updateWindowSideTitle').html('<a href="'+href({'page':'naplo','sub':'intezmeny','f':'tanar','tanarId':adat['tanarId']})+'">'+adat['tanarNev']+'</a>');
    	    $('#updateWindowSideContent').html(content);
    	    $('#updateWindowSide').addClass('nyitva');
	}

}

processJSONOraAdat = function(adat) {

        var content = '';
	var dolgozatAdat;

	content += '<div id="mayorNaviIconHolder">';
	content += '<div class="mayorNaviIcon"><a href="'+href({'page':'naplo','sub':'haladasi','f':'haladasi','tanarId':adat['oraAdat']['ki'],'tankorId':adat['oraAdat']['tankorId']})+'"><span class="icon-file-edit-alt"></span><br/>Haladási</a></div>';
	content += '<div class="mayorNaviIcon"><a href="'+href({'page':'naplo','sub':'hianyzas','f':'ora','oraId':adat['oraId']})+'"><span class="icon-calendar-sign"></span><br/>Hiányzások</a></div>';
	content += '</div>';

	content += '<h3>A haladási óra adatai</h3>';	
	content += '<ul>';
	content += '<li>Típus: ' + adat['oraAdat']['tipus'] +'</li>';
	content += '<li>Tankör: ' + adat['oraAdat']['tankorNev']+'</li>';
	if (adat['oraAdat']['kiCn']!='') content += '<li><span class="tanarNev" data-tanarid="'+adat['oraAdat']['ki']+'" >Tanár: ' + adat['oraAdat']['kiCn'] +'</span></li>';
//	if (adat['oraAdat']['kiCn']!='') content += '<li><span>Tanár: ' + adat['oraAdat']['kiCn'] +'</li>';
	if (adat['oraAdat']['kitCn']!='') content += '<li>Helyettesítendő: ' + adat['oraAdat']['kitCn'] +'</li>';
	content += '<li>Terem: ' + (adat['oraAdat']['teremId']==null?'–':adat['oraAdat']['teremId']) +'</li>';
	content += '<li>Leírás: ' + mayorLeiras(adat['oraAdat']['leiras']) +'</li>';
	content += '</ul>';

	if (adat['oraBeirhato']) content += adat['oraForm'];

//	content += '<h3>Óra kapcsolatai</h3>';	
//	content += '<ul><li>Beírt mulasztások száma: '+'n/a'+'</li>';
//	content += '<li>Beírt jegyek száma: '+'n/a'+'</li>';
//	content += '</ul>';

	if (adat['dolgozat']['dolgozatIds'].length>0) {
	    content += '<h3>Dolgozatok</h3>';
	    content += '<ul>';
	    for (i=0; i<adat['dolgozat'].dolgozatIds.length; i++) {
		dolgozatAdat = adat['dolgozat'][adat['dolgozat'].dolgozatIds[i]];
		content += '<li class="dolgozatAdat" data-dolgozatid="'+dolgozatAdat['dolgozatId']+'">'+dolgozatAdat['tervezettDt']+': '+ dolgozatAdat.dolgozatNev + '</li>'; 
		// bejelentesDt, tervettDt, tankor...
	    }
	    content += '</ul>';
	}
	
	if (adat['elozoOrak']!=undefined && adat['elozoOrak'].length>0) {
	    content += '<h3>Előző órák</h3>';
	    content += '<ul>';
	    for (i=0; i<adat['elozoOrak'].length; i++) {
		content += '<li class="oraAdat" data-oraid="'+adat['elozoOrak'][i]['oraId']+'">'
		    + adat['elozoOrak'][i]['dt'] + ' '
		    + adat['elozoOrak'][i]['ora'] + '. óra '
		    + mayorLeiras(adat['elozoOrak'][i]['leiras'])
		    + '</li>';
	    }
	    content += '</ul>';
	}

//	content += '<div class="oraErtekel" data-oraid="1" data-jovolt="1">+++++</div>';
//	content += '<div class="oraErtekel" data-oraid="1" data-jovolt="0">-----</div>';

    content += '<span style="display:none" id="mayorsidewindowtype" data-mayorsidewindowtype="oraAdat"></span>';
    if (    $('#updateWindowSide').hasClass('nyitva') ==true && $('#mayorsidewindowtype').data('mayorsidewindowtype')!='oraAdat' ) {
        $('#updateWindowSideSubContent').html(content);
        $('#updateWindowSideSubTitle').html('<a href="'+href({'page':'naplo','sub':'hianyzas','f':'ora','oraId':adat['oraId']})+'">Haladási napló</a>');
        $('#updateWindowSideSub').addClass('nyitva');
    } else {
        $('#updateWindowSideContent').html(content);
        $('#updateWindowSideTitle').html('<a href="'+href({'page':'naplo','sub':'hianyzas','f':'ora','oraId':adat['oraId']})+'">Haladási napló órája</a>');
        $('#updateWindowSide').addClass('nyitva');
    }

}

processJSONJegyAdat = function(adat) {

        var content = '';

	content += '<div id="mayorNaviIconHolder">';
	content += '<div class="mayorNaviIcon"><a href="'+href({'page':'naplo','sub':'osztalyozo','f':'jegy','jegyId':adat['jegyId']})+'"><span class="icon-pencil-alt"></span><br/>Jegy</a></div>';
	content += '</div>';

	content += '<h3>A jegy adatai</h3>';
	content += '<ul>';
	content += '<li>Értékelés (rövid): ' + adat['jegyAdat']['rovid'] +'</li>';
	content += '<li>Hivatalos értékelés: ' + adat['jegyAdat']['hivatalos'] +'</li>';
	content += '<li>Diák: <span class="diakNev" data-diakid="'+adat['jegyAdat']['diakId']+'">' + adat['diakNev'] +'</span></li>';
	content += '<li>Diák azonosító: ' + adat['jegyAdat']['diakId'] +'</li>';
	content += '<li>Tárgy: ' + adat['targyNev'] + ' (' + adat['jegyAdat']['targyId'] +')</li>';
	content += '<li>Jegy típus: ' + adat['jegyAdat']['jegyTipus'] +'</li>';
	content += '<li>Jegy érték: ' + adat['jegyAdat']['jegy'] +'</li>';
	if (adat['jegyAdat']['oraId']>0)  content += '<li>Kapcsolódó óra: <span class="oraAdat" data-oraid="'+adat['jegyAdat']['oraId']+'">'+ adat['jegyAdat']['oraId'] +'</span></li>';
	if (adat['jegyAdat']['dolgozatId']>0)  content += '<li>Kapcsolódó dolgozat: <span class="dolgozatAdat" data-dolgozatid="'+adat['jegyAdat']['dolgozatId']+'">'+ adat['jegyAdat']['dolgozatId'] +'</span></li>';
	content += '<li>Megjegyzés: ' + adat['jegyAdat']['megjegyzes'] +'</li>';
	content += '<li>Beírás dátuma: ' + adat['jegyAdat']['dt'] +'</li>';
	if (adat['jegyAdat']['modositasDt']!='0000-00-00 00:00:00') content += '<li>Utolsó módosítás: ' + adat['jegyAdat']['modositasDt'] +'</li>';

//	if (adat['oraAdat']['kiCn']!='') content += '<li>Tanár: ' + adat['oraAdat']['kiCn'] +'</li>';
//	if (adat['oraAdat']['kitCn']!='') content += '<li>Helyettesítendő: ' + adat['oraAdat']['kitCn'] +'</li>';
	content += '</ul>';

    //	content += adat['jegySelect'];

    content += '<span style="display:none" id="mayorsidewindowtype" data-mayorsidewindowtype="jegyAdat"></span>';
    if (    $('#updateWindowSide').hasClass('nyitva') ==true && $('#mayorsidewindowtype').data('mayorsidewindowtype')!='jegyAdat' ) {
        $('#updateWindowSideSubContent').html(content);
        $('#updateWindowSideSubTitle').html('Jegy adatai');
        $('#updateWindowSideSub').addClass('nyitva');
    } else {
        $('#updateWindowSideContent').html(content);
        $('#updateWindowSideTitle').html('Jegy adatai');
        $('#updateWindowSide').addClass('nyitva');
    }
}

processJSONZaroJegyAdat = function(adat) {

        var content = '';
	content += '<h3>A zárójegy adatai</h3>';
	content += '<ul>';
	content += '<li>Hivatalos értékelés: ' + adat['zaroJegyAdat']['hivatalos'] +'</li>';
	content += '<li>Értékelés (rövid): ' + adat['zaroJegyAdat']['rovid'] +'</li>';
	content += '<li>Diák: <span class="diakNev" data-diakid="'+adat['zaroJegyAdat']['diakId']+'">' + adat['diakNev'] +'</span></li>';
	content += '<li>Diák azonosító: ' + adat['zaroJegyAdat']['diakId'] +'</li>';
	content += '<li>Tárgy: ' + adat['targyNev'] + ' ' + adat['zaroJegyAdat']['targyId'] +'</li>';
	content += '<li>Évfolyamjel: ' + adat['zaroJegyAdat']['evfolyamJel'] +'</li>';
	content += '<li>Félév: ' + adat['zaroJegyAdat']['felev'] +'</li>';
	content += '<li>Jegy típus: ' + adat['zaroJegyAdat']['jegyTipus'] +'</li>';
	content += '<li>Jegy érték: ' + adat['zaroJegyAdat']['jegy'] +'</li>';
	content += '<li>Megjegyzés: ' + adat['zaroJegyAdat']['megjegyzes'] +'</li>';
	content += '<li>Módosítás dátuma: ' + adat['zaroJegyAdat']['modositasDt'] +'</li>';
	content += '<li>Hivatalos dátum: ' + adat['zaroJegyAdat']['hivatalosDt'] +'</li>';
	content += '</ul>';

	if (adat['fotargy']==true) {
	    content += '<h3>Főtárgy</h3>';
	}
	if (adat['altargy']==true) {
	    content += '<h3>Altárgy</h3>';
	}

	// content += adat['jegySelect'];
	// console.log(adat);
	content += '<span style="display:none" id="mayorsidewindowtype" data-mayorsidewindowtype="zaroJegyAdat"></span>';
    if (    $('#updateWindowSide').hasClass('nyitva') ==true && $('#mayorsidewindowtype').data('mayorsidewindowtype')!='zaroJegyAdat' ) {
        $('#updateWindowSideSubContent').html(content);
        $('#updateWindowSideSubTitle').html('Osztályzat, zárójegy');
        $('#updateWindowSideSub').addClass('nyitva');
    } else {
        $('#updateWindowSideContent').html(content);
        $('#updateWindowSideTitle').html('Osztályzat, zárójegy');
        $('#updateWindowSide').addClass('nyitva');
    }
}

processJSONOsztalyAdat = function(adat) {

    if (adat.visibleData != true) return false;
    var content = '';

    content += '<div id="mayorNaviIconHolder">';
	content += '<div class="mayorNaviIcon"><a href="'+href({'page':'naplo','sub':'orarend','f':'orarend','osztalyId':adat['osztalyId']})+'"><span class="icon-th"></span><br/>Órarend</a></div>';
	content += '<div class="mayorNaviIcon"><a href="'+href({'page':'naplo','sub':'haladasi','f':'haladasi','osztalyId':adat['osztalyId']})+'"><span class="icon-file-edit-alt"></span><br/>Haladási</a></div>';
    content += '</div>';

    content += '<span style="display:none" id="mayorsidewindowtype" data-mayorsidewindowtype="osztaly"></span>';
    if (    $('#updateWindowSide').hasClass('nyitva') ==true && $('#mayorsidewindowtype').data('mayorsidewindowtype')!='osztaly' ) {
	$('#updateWindowSideSubTitle').html(adat['nev']);
	$('#updateWindowSideSubContent').html(content);
	$('#updateWindowSideSub').addClass('nyitva');    
    } else {
	$('#updateWindowSideTitle').html(adat['nev']);
	$('#updateWindowSideContent').html(content);
	$('#updateWindowSide').addClass('nyitva');    
    }

}

processJSONTankorAdat = function(adat) {

	if (adat.visibleData != true) return false;
        var content = '';

	content += '<div id="mayorNaviIconHolder">';
	content += '<div class="mayorNaviIcon"><a href="'+href({'page':'naplo','sub':'orarend','f':'orarend','tankorId':adat['tankorId']})+'"><span class="icon-th"></span><br/>Órarend</a></div>';
	content += '<div class="mayorNaviIcon"><a href="'+href({'page':'naplo','sub':'haladasi','f':'haladasi','tankorId':adat['tankorId']})+'"><span class="icon-file-edit-alt"></span><br/>Haladási</a></div>';
//	content += '<div class="mayorNaviIcon"><a href="'+href({'page':'naplo','sub':'intezmeny','f':'tanarTankor','diakId':tanarAdat['diakId']})+'"><span class="icon-group-alt"></span><br/>Tankörök</a></div>';
	content += '<div class="mayorNaviIcon"><a href="'+href({'page':'naplo','sub':'osztalyozo','f':'tankor','tankorId':adat['tankorId']})+'"><span class="icon-pencil-alt"></span><br/>Osztályozó</a></div>';
	content += '<div class="mayorNaviIcon"><a href="'+href({'page':'naplo','sub':'tanmenet','f':'tanmenetInfo','tanmenetId':adat['tanmenetId']})+'"><span class="icon-calendar-sign"></span><br/>Tanmenet</a></div>';
	content += '<div class="mayorNaviIcon"><a href="'+href({'page':'naplo','sub':'uzeno','f':'uzeno','tankorId':adat['tankorId']})+'"><span class="icon-envelope"></span><br/>Üzenő</a></div>';

	content += '</div>';


    if (adat.tankorTanar!=undefined) {
	content += '<h3>Tanárok</h3>';
	content += '<ul>';
	for (i=0; i<adat.tankorTanar.length; i++) {
	    content += '<li><span class="tanarNev" data-tanarid="'+adat.tankorTanar[i]['tanarId']+'">'+adat.tankorTanar[i].tanarNev+'</span> ('+adat.tankorTanar[i]['minBeDt']+'–'+adat.tankorTanar[i]['maxKiDt']+')</li>';
	}
	content += '</ul>';
    }

    content += '<h3>'+adat['leiras']+'</h3>';
    content += '<ul>';
	content += '<li>névsor: '+adat['nevsor']+'</li>';
	content += '<li>választható: '+adat['felveheto']+' ('+adat['min']+'-'+adat['max']+')</li>';
	content += '<li>jelenlét: '+adat['jelenlet']+'</li>';
	content += '<li>hiányzás regisztrálandó: '+adat['regisztralando']+'</li>';
	content += '<li>hiányzás beleszámít: '+adat['hianyzasBeleszamit']+'</li>';
	content += '<li>óraszám: '+adat['oraszam']+'</li>';
    content += '</ul>';

    if (adat.tankorBlokk.length>0) {
	content += '<h3>Tankörblokk ('+adat.tankorBlokk.length+')</h3>';
	content += '<ul>';
	for (i=0; i<adat.tankorBlokk.length; i++) {
	    content += '<li>'+adat.tankorBlokk[i].blokkNev+'</li>';
	}
	content += '</ul>';
    }
    if (adat.tanmenetId>0) {
	content += '<h3>Tanmenet ('+adat.tanmenetId+')</h3>';
	content += '<ul>';
	content += '<li>név: <a href="'+href({'page':'naplo','sub':'tanmenet','f':'tanmenetInfo','tanmenetId':adat['tanmenetId']})+'">'+adat.tanmenetAdat.tanmenetNev+'</a></li>';
	content += '<li>évfolyam jel: '+adat.tanmenetAdat.evfolyamJel+'</li>';
	content += '<li>tárgy: '+adat.tanmenetAdat.targyNev+'</li>';
	content += '<li>óraszám: '+adat.tanmenetAdat.oraszam+'</li>';
	content += '<li>státusz: '+adat.tanmenetAdat.statusz+'</li>';
//	for (i=0; i<adat.tanmenetAdat.length; i++) {
//	    content += '<li>'+adat.tanmenetAdat[i]+'</li>';
//	}
	content += '</ul>';
    }


    content += '<h3>Osztályok</h3>';
    content += '<ul>';
	if (adat.osztalyIds!=undefined) {
	for (i=0; i<adat.osztalyIds.length; i++) {
	    osztalyId = adat.osztalyIds[i];
	    for (j=0; j<adat.osztalyok.length; j++) {
		var index = adat.osztalyok[j].osztalyId
		if (index == osztalyId) osztalyAdat = adat.osztalyok[j];
	    }
	    content += '<li><a href="'+  href({'page':'naplo','sub':'intezmeny','f':'osztaly','osztalyId':osztalyId}) +'">'+osztalyAdat.osztalyJel+' ('+osztalyAdat.leiras+') '+osztalyAdat.osztalyfonokNev+'</a></li>';
	}
	}
    content += '</ul>';

    content += '<h3><a href="'+href({'page':'naplo','sub':'intezmeny','f':'tankorDiak','tankorId':adat['tankorId']})+'">Névsor</a> ('+adat.tankorDiak.idk.length+')</h3>';
    content += '<ul>';
	if (adat.tankorDiak.idk!=undefined) {
	    var _diakId = 0;
	    for (i=0; i<adat.tankorDiak.idk.length; i++) {
	    _diakId = adat.tankorDiak.idk[i];
	    diakNev = adat.tankorDiak.nevek[_diakId].diakNev;
//	    content += '<li><a href="'+  href({'page':'naplo','sub':'intezmeny','f':'osztaly','diakId':diakId}) +'">'+osztalyAdat.osztalyJel+' ('+osztalyAdat.leiras+') '+osztalyAdat.osztalyfonokNev+'</a></li>';
	    content += '<li><span class="diakNev diakAdat" data-diakid="'+ _diakId +'">'+ diakNev +'</span></li>';
	    }
	}
    content += '</ul>';

    content += '<span style="display:none" id="mayorsidewindowtype" data-mayorsidewindowtype="tankor"></span>';
    if (    $('#updateWindowSide').hasClass('nyitva') ==true && $('#mayorsidewindowtype').data('mayorsidewindowtype')!='tankor' ) {
	$('#updateWindowSideSubTitle').html(adat['tankorNev']);
	$('#updateWindowSideSubContent').html(content);
	$('#updateWindowSideSub').addClass('nyitva');    
    } else {
	$('#updateWindowSideTitle').html(adat['tankorNev']);
	$('#updateWindowSideContent').html(content);
	$('#updateWindowSide').addClass('nyitva');    
    }

}


processJSONSzuloAdat = function( adat ) {

        var content = '';

//	content += '<div id="mayorNaviIconHolder">';
//	content += '</div>';

	content += "<h3>Elérhetőségek</h3>";
        content += '<ul>';
	    content += '<li>Felhasználónév: '+adat['userAccount']+'</li>';
	    content += '<li>Email: '+adat['email']+'</li>';
	    content += '<li>Mobiltelefon: '+adat['mobil']+'</li>';
	    content += '<li>Foglalkozás: '+adat['foglalkozas']+'</li>';
	    content += '<li>Munkahely: '+adat['munkahely']+'</li>';
	    content += '<li>Lakik: ' 
		+adat['cimIrsz'] + ' '
		+adat['cimHelyseg'] + ', '
		+adat['cimKozteruletNev'] + ' '
		+adat['cimKozteruletJelleg'] + ' '
		+adat['cimHazszam']
	    + '</li>';

	content += '</ul>';	

	content += "<h3>Szülő adatai</h3>";
        content += '<ul>';
	    content += '<li>Státusz: '+adat['statusz']+'</li>';	    
	    content += '<li>Születési adatok: '+'-'+'</li>';	    
	content += '</ul>';	


        content += "<h3>Gyermekei</h3>";
        content += '<ul>';
	    if (adat['szuloGyermekei']!=undefined)
    	    for (i=0; i<adat['szuloGyermekei'].length; i++) {
                var d = adat['szuloGyermekei'][i];
                content += '<li>';
		    content += '<a href="'+  href({'page':'naplo','sub':'intezmeny','f':'diak','diakId':d['diakId']}) +'">';
		    content += d['diakNev'];
		    content += '</a>';
		content += '</li>';
	    }

        content += '</ul>';

    content += '<span style="display:none" id="mayorsidewindowtype" data-mayorsidewindowtype="szulo"></span>';
    content = content.replace(/undefined/g, "-"); // testing

    if (    $('#updateWindowSide').hasClass('nyitva') ==true && $('#mayorsidewindowtype').data('mayorsidewindowtype')!='szulo' ) {
	//$('#updateWindowSideSubTitle').html(adat['szuloNev']);
        $('#updateWindowSideSubTitle').html('<a href="'+href({'page':'naplo','sub':'intezmeny','f':'diakSzulo','szuloId':adat['szuloId']})+'">'+adat['szuloNev']+'</a>');
	$('#updateWindowSideSubContent').html(content);
	$('#updateWindowSideSub').addClass('nyitva');    
    } else {
        $('#updateWindowSideTitle').html('<a href="'+href({'page':'naplo','sub':'intezmeny','f':'diakSzulo','szuloId':adat['szuloId']})+'">'+adat['szuloNev']+'</a>');
	//$('#updateWindowSideTitle').html(adat['szuloNev']);
	$('#updateWindowSideContent').html(content);
	$('#updateWindowSide').addClass('nyitva');    
    }

}


processJSONJegyzetAdat = function(adat) {

	if (adat.visibleData != true) return false;
        var content = '';
	content += '<p>'+adat['jegyzetForm']+'</p>';

    content += '<span style="display:none" id="mayorsidewindowtype" data-mayorsidewindowtype="jegyzet"></span>';
    if (    $('#updateWindowSide').hasClass('nyitva') ==true && $('#mayorsidewindowtype').data('mayorsidewindowtype')!='jegyzet' ) {
	$('#updateWindowSideSubTitle').html(adat['leiras']);
	$('#updateWindowSideSubContent').html(content);
	$('#updateWindowSideSub').addClass('nyitva');    
    } else {
	$('#updateWindowSideTitle').html(adat['leiras']);
	$('#updateWindowSideContent').html(content);
	$('#updateWindowSide').addClass('nyitva');    
    }

}

processJSONNapAdat = function(adat) {

//	if (adat.visibleData != true) return false;
        var content = '';

    content += '<ul>'
    content += '<li>Tanítási nap: '+adat['tanitasiNapAdat'][adat['dt']]['napszam']+'</li>';

    for (i=0; i<adat.napAdat.length; i++) {
	content += '<li>';
	content += adat.napAdat[i]['munkatervId']+'. munkaterv szerint:';
	content += '<ul>';
	content += '<li>nap típus: '+adat.napAdat[i]['tipus']+'</li>';
	content += '<li>csengetési rend: '+adat.napAdat[i]['csengetesiRendTipus']+'</li>';
	content += '<li>megjegyzés: '+adat.napAdat[i]['megjegyzes']+'</li>';
	content += '</ul>';
	content += '</li>';
    }
    content += '</ul>';


    content += '<span style="display:none" id="mayorsidewindowtype" data-mayorsidewindowtype="napAdat"></span>';
    if (    $('#updateWindowSide').hasClass('nyitva') ==true && $('#mayorsidewindowtype').data('mayorsidewindowtype')!='napAdat' ) {
	$('#updateWindowSideSubTitle').html(adat['leiras']);
	$('#updateWindowSideSubContent').html(content);
	$('#updateWindowSideSub').addClass('nyitva');    
    } else {
	$('#updateWindowSideTitle').html(adat['leiras']);
	$('#updateWindowSideContent').html(content);
	$('#updateWindowSide').addClass('nyitva');    
    }

}

processJSONDolgozatAdat = function(adat) {

//	if (adat.visibleData != true) return false;
        var content = '';
	var tankorAdat;
	content += '<div id="mayorNaviIconHolder">';
	content += '<div class="mayorNaviIcon"><a href="'+href({'page':'naplo','sub':'osztalyozo','f':'dolgozat','dolgozatId':adat['dolgozatId']})+'"><span class="icon-idea-alt"></span><br/>Dolgozat adatok</a></div>';
	content += '<div class="mayorNaviIcon"><a href="'+href({'page':'naplo','sub':'osztalyozo','f':'tankor'})+'"><span class="icon-pencil-alt"></span><br/>Jegyek</a></div>';
	content += '</div>';


    content += '<ul>'
    content += '<li>Leírás: <i>'+adat['dolgozatAdat']['dolgozatNev']+'</i></li>';
    content += '<li>Bejelentés: '+adat['dolgozatAdat']['bejelentesDt']+'</li>';
    content += '<li>Tervezett: '+adat['dolgozatAdat']['tervezettDt']+'</li>';
    content += '</ul>';

    content += '<h3>Tankörök</h3>';
        content += '<ul>';
        for (i=0; i<adat['dolgozatAdat']['tankorok'].length; i++) {
	    tankorAdat = adat['dolgozatAdat']['tankorok'][i][0];
            content += '<li class="tankorAdat" data-tankorid="'+tankorAdat['tankorId']+'">' +tankorAdat['tankorNev']+'</li>';
        }
        content += '</ul>';
    
    content += '<h3>Érdemjegy statisztika</h3>';
    content += '<ul>'
    content += '<li>Beírt jegy: '+adat['dolgozatAdat']['jegyStatisztika']['db']+'</li>';
    content += '<li>Átlag: '+adat['dolgozatAdat']['jegyStatisztika']['atlag']+'</li>';
    content += '</ul>';
    
    content += '<span style="display:none" id="mayorsidewindowtype" data-mayorsidewindowtype="dolgozatAdat"></span>';
    if (    $('#updateWindowSide').hasClass('nyitva') ==true && $('#mayorsidewindowtype').data('mayorsidewindowtype')!='dolgozatAdat' ) {
	$('#updateWindowSideSubTitle').html(adat['leiras']);
	$('#updateWindowSideSubContent').html(content);
	$('#updateWindowSideSub').addClass('nyitva');    
    } else {
	$('#updateWindowSideTitle').html(adat['leiras']);
	$('#updateWindowSideContent').html(content);
	$('#updateWindowSide').addClass('nyitva');    
    }

}


// -----------------------------------------------------------------
mayorNaploEventHandlers = function() {

    $('.jegyzetAdat').off('click').on('click', function(event) {
	// credits: rpetya (rakolcza.peter@gmail.com)
        element = $(event.target);
	var elementData = element.data();
	var ID = '';
	var refJegyzetDt = '';
	if ( elementData.hasOwnProperty('jegyzetid')==true ) {
    	    ID = (element.data('jegyzetid'));
	    refJegyzetDt = (element.data('jegyzetdt'));
	} else if ( $(this).data().hasOwnProperty('jegyzetid')==true ) {
    	    ID = $(this).data('jegyzetid');
	    refJegyzetDt = $(this).data('jegyzetdt');
	}
	//event.stopPropagation();
    	if (ID!='') ajaxGetJegyzetAdat(ID,refJegyzetDt);
    });

    $('.setOraAdat').off('click').on('click', function(event) {
    	ajaxSetOraAdat($(this).parents('form').serialize());
    });
    $('.setJegyzetAdat').off('click').on('click', function(event) {
    	ajaxSetJegyzetAdat($(this).parents('form').serialize());
    });

    $('.delJegyzet').off('click').on('click', function(event) {
    	ajaxDelJegyzet($(this).parents('form').serialize());
    });

    $('.oraAdat').off('click').on('click', function(event) {
        element = $(event.target);
	var elementData = element.data();
	var ID = '';
	if ( elementData.hasOwnProperty('oraid')==true ) {
    	    ID = (element.data('oraid'));
	} else if ( $(this).data().hasOwnProperty('oraid')==true ) {
    	    ID = $(this).data('oraid');
	}
    	if (ID!='') ajaxGetOraAdat(ID);
	$('.oraAdat').removeClass('activeElement');
	$(this).addClass('activeElement');
    });

    $('.dolgozatAdat').off('click').on('click', function(event) {
        element = $(event.target);
	var elementData = element.data();
	var ID = '';
	if ( elementData.hasOwnProperty('dolgozatid')==true ) {
    	    ID = (element.data('dolgozatid'));
	} else if ( $(this).data().hasOwnProperty('dolgozatid')==true ) {
    	    ID = $(this).data('dolgozatid');
	}
    	if (ID!='') ajaxGetDolgozatAdat(ID);
    });

    $('.napAdat').off('click').on('click', function(event) {
        element = $(event.target);
	var elementData = element.data();
	var ID = '';
	if ( elementData.hasOwnProperty('napdt')==true ) {
    	    ajaxGetNapAdat(element.data('napdt'));
	}
    });

    $('.diakNev').off('click').on('click', function(event) {
        element = $(event.target);
	var elementData = element.data();
	var ID = '';
	if ( elementData.hasOwnProperty('diakid')==true ) {
    	    ID = element.data('diakid');
	} else if ( $(this).data().hasOwnProperty('diakid')==true ) {
    	    ID = $(this).data('diakid');
	}
	if (ID!='') ajaxGetDiakAdat(ID);
    });

    $('.tanarNev').off('click').on('click', function(event) {

        element = $(event.target);
	var elementData = element.data();
	var ID = '';
	if ( elementData.hasOwnProperty('tanarid')==true ) {
    	    ID = element.data('tanarid');
	} else if ( $(this).data().hasOwnProperty('tanarid')==true ) {
    	    ID = $(this).data('tanarid');
	}
	if (ID!='') ajaxGetTanarAdat(ID);
    });

    $('.szuloNev').off('click').on('click', function(event) {
        element = $(event.target);
	var elementData = element.data();
	var ID = '';
	if ( elementData.hasOwnProperty('szuloid')==true ) {
    	    ajaxGetSzuloAdat(element.data('szuloid'));
	}
    });

} // mayorNaploEventHandlers
// -----------------------------------------------------------------

updateJegyzet = function(adat) {

    $('#orarendJegyzetSor').show();
    var jegyzetId = parseInt(adat['jegyzetId']);
    $('.jegyzetContainer[data-dt!="'+adat['dt']+'"] div.jegyzetAdat[data-jegyzetid='+jegyzetId+']').remove();
    $('div.jegyzetAdat[data-jegyzetid='+jegyzetId+']').remove();
    var result = $('div.jegyzetAdat[data-jegyzetid="'+(jegyzetId)+'"]').text(adat.jegyzetLeiras);
    if (result.length==0) {
	var o = '<div class="jegyzet jegyzetAdat publikus'+adat['publikus']+'" data-jegyzetid="'+jegyzetId+'"></div>';
	$('.jegyzetContainer[data-dt="'+adat['dt']+'"]').append(o);
	$('div.jegyzetAdat[data-jegyzetid="'+jegyzetId+'"]').text(adat.jegyzetLeiras);
    }
    // minden nyitva levőt bezár  -- TODO -- altalanos
    $('#updateWindowSideSub').removeClass('nyitva');
    $('#updateWindowSide').removeClass('nyitva');
    if ($.isFunction(hideUpdateWindowSide)) hideUpdateWindowSide();
    if ($.isFunction(hideUpdateWindowSideSub)) hideUpdateWindowSideSub();
}

removeJegyzet = function(adat) {
    var jegyzetId = parseInt(adat['jegyzetId']);
    $('div.jegyzetAdat[data-jegyzetid='+jegyzetId+']').remove();
    // minden nyitva levőt bezár  -- TODO -- altalanos
    $('#updateWindowSideSub').removeClass('nyitva');
    $('#updateWindowSide').removeClass('nyitva');
    if ($.isFunction(hideUpdateWindowSide)) hideUpdateWindowSide();
    if ($.isFunction(hideUpdateWindowSideSub)) hideUpdateWindowSideSub();
}

hideUpdateWindowSide = function() { 
    $('.oraAdat').removeClass('activeElement');
}

mayorLeiras = function(str) {
    if (str==undefined || str=='' || str == false) {
	return '<i>–</i>';
    } else {
	return '<i>' + $('<div/>').text(str).html() + '</i>';
    }
}

mayorLoaderStop = function() { // overwrite orig
    mayorNaploEventHandlers();
    mayorLoaderCounter--;
    if (mayorLoaderCounter==0) {
	$('#poz li:first').removeClass('mayorLoader');
    }
}

ajaxSetOraLike = function(oraId, jovolt) {}
