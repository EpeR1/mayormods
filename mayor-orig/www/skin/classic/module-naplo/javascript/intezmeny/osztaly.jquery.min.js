
$(function () {

    var evfolyamJelek = [];
    $('body').change(function(event) {

	element = $(event.target);

	if (element.attr('id')=='osztalyJellegId') {
	    if (element.val() != '') {
		element.closest('div').nextAll('div').slideUp();
		$('#divKezdoTanev').slideDown().focus();
		element.data('evfolyamjelek',element.find('option:selected').data('evfolyamjelek'));
		evfolyamJelek = $('#osztalyJellegId').data('evfolyamjelek');
		$('span#kezdoEvfolyamJel').html(evfolyamJelek[0]);
	    }
	} else if (element.attr('id')=='kezdoTanev') {
	    if (element.val() != '') {
		$('#vegzoTanev option:selected').prop('selected',false);
		$('#vegzoTanev').find('option').prop('disabled',true).hide();
		$('#vegzoTanev').find('option:first-child').prop('disabled',false).show();
		vtOptions = $('#vegzoTanev').find('option').get();
		i=0;
		while (i<vtOptions.length && $(vtOptions[i]).val() != element.val()) i++;
		for (j=i; j<vtOptions.length && j < i+evfolyamJelek.length; j++) $(vtOptions[j]).prop('disabled',false).show();
		$('#divVegzoTanev').slideDown().focus();
	    }
	} else if (element.attr('id') == 'vegzoTanev') {

	    ulStr = 'Kezdés évfolyama: <ul id="evfolyamJelek">';
	    maxKS = evfolyamJelek.length-($('#vegzoTanev').val()-$('#kezdoTanev').val());
	    osztalyJel = $('#jel').val();
	    for (i=0; i<evfolyamJelek.length; i++) {
		if (i<$('#vegzoTanev').val()-$('#kezdoTanev').val()+1) ulStr += '<li class="kivalasztott">';
		else ulStr += '<li>';
		ulStr += evfolyamJelek[i]+'.&nbsp;<span class="osztalyJel">'+(osztalyJel==''?'?':osztalyJel)+'</span>';
		if (i < maxKS) ulStr += '<br /><input type="radio" name="kezdoEvfolyamSorszam" value="'+(i+1)+'" '+(i==0?' checked="checked" ':'')+'/>';
		ulStr += '</li>';
	    }
	    ulStr += '</ul>';
	    $('#divKezdoEvfolyamSorszam').html(ulStr);
	    $('#divJel').slideDown().focus();
	    $('#divKezdoEvfolyamSorszam').slideDown();
	} else if (element.closest('ul').attr('id') == 'evfolyamJelek') {
	    element.closest('ul').find('li').removeClass('kivalasztott');
	    e = element.closest('li'); i=0;
	    while (i<$('#vegzoTanev').val()-$('#kezdoTanev').val()+1) {
		e.addClass('kivalasztott');
		e = e.next('li');
		i++;
	    }
	} else if (element.attr('id') == 'jel') {
	    $('#divKezdoEvfolyamSorszam li span.osztalyJel').html(element.val());
	    $('#divLeirasTelephely').slideDown();
	}
    });
});
