$(function() {

    function isMobile() { // --TODO -- global namespace
	try{ document.createEvent("TouchEvent"); return true; }
	catch(e){ return false; }
    }

    var origHtmlStr = $('table.orarend thead th.het').html();

    $('table.orarend thead tr th').on('click',function() { // tool kezeles mobilon
	if ($(this).data('napindex')>0 && isMobile() == true) {
	    $(this).find('table.orarend span.napLeiras').toggle();
	    $(this).find('table.orarend div.orarendTools').toggle();
	}
    });


	if ($('table.orarend tr th.ma').length>0 && $('html').width()<500) {
	    for (var i=1; i<=6; i++) $('table.orarend *[data-napindex="'+i+'"]').not('.ma').hide();
	    $('table.orarend thead th.het').html('<div class="icon-repeat-alt" style="font-size:20px"></div>');
	}


	$('table.orarend tbody tr.orarendJegyzetSor th').on('click', function() {
	    $('table.orarend tbody tr.orarendJegyzetSor').hide();
	    $('table.orarend thead th.het').html('<div class="icon-repeat-alt" style="font-size:20px"></div>');
	});

	$('table.orarend tr th span.bezar').click(function() {
	    // event.stopPropagation();
	    var napindex = ($(this).parents('th').data('napindex'));
	    if (napindex==undefined) {
		//for (var i=1; i<=6; i++) $('table.orarend *[data-napindex="'+i+'"]').not('.ma').toggle('right');
		for (var i=1; i<=6; i++) $('table.orarend *[data-napindex="'+i+'"]').show('right');
		$('table.orarend thead th.het').html(origHtmlStr);
	    } else { 
		$('table.orarend *[data-napindex="'+napindex+'"]').hide('left');
		$('table.orarend thead th.het').html('<div class="icon-repeat-alt" style="font-size:20px"></div>');
	    }
	});
	$('table.orarend tr th.het').click(function(event) {
	    event.stopPropagation();
	    for (var i=1; i<=6; i++) $('table.orarend *[data-napindex="'+i+'"]').show('right');
	    $('table.orarend thead th.het').html(origHtmlStr);
	    $('table.orarend tbody tr.orarendJegyzetSor').show();
	});
	// $(window).resize(orarendResizer); // missing
	$('.most').parent('th').addClass('most');
        $('table.orarend td.csr').bind('mouseenter', function(event) {
            var el = $(event.target);
	    var iid = '';
	    var thiselement = null;
	    if (el.is('td') && el.attr('id')!='') {
		iid = el.attr('id')
		thiselement = el;
	    } else if (el.parents('td').attr('id')!='') {
		iid = el.parents('td').attr('id');
		thiselement = el.parents('td');
	    }
	    if (iid!='undefined' && iid!='') {
		var nap = iid.split('_')[2];
		for (var i=1; i<=7; i++) {
		    if (nap==i) {
			$('.csr_'+i).show();
			$('.csr_'+i).parent('th').removeClass('most');
			$('.most').parent('th').addClass('most');
		    }
		    else $('.csr_'+i).hide();
		}
	    }
	    // hover
	    var napindex = thiselement.data('napindex');
	    $('table.orarend thead tr th[data-napindex="'+napindex+'"]').addClass('hover');
	    var oraindex = thiselement.data('oraindex');
	    $('table.orarend tbody tr th[data-oraindex="'+oraindex+'"]').addClass('hover');
	});
        $('table.orarend td.csr').bind('mouseleave', function(event) {
	    $('table.orarend thead tr th').removeClass('hover');
	    $('table.orarend tbody tr th').removeClass('hover');
	});
});
