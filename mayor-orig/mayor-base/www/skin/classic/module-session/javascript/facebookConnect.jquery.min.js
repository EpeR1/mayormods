$(document).ready(function() {
    $('#grantFbAuth').submit(function() { // facebook
            FB.getLoginStatus(function(response) {
                if (response.status === 'connected') {
                    mayor_facebookconnect_redirect();
                } else if (response.status === 'not_authorized') {
                    FB.login(function(loginResponse) {
                        if (loginResponse.status=='connected') {
                            mayor_facebookconnect_redirect();
                        }
                    });
                } else {
                    FB.login(function(loginResponse) {
                        if (loginResponse.status=='connected') {
                            mayor_facebookconnect_redirect();
                        }
                    });
                }
            },true);
            return false;
  });

  var mayor_facebookconnect_redirect = function() {
    var origUrl = $(location).attr('href');
    var pos = origUrl.indexOf("?");
    if (pos != -1) url = origUrl+'&action=grantFbAuth';
    else url = origUrl+'?action=grantFbAuth';
    window.location = url;
  }

});