$(document).ready(function() {
 if (typeof(GOOGLEAPI_CLIENT_ID)!=='undefined' && GOOGLEAPI_CLIENT_ID!='') {
   gapi.load('auth2', function(){
      auth2 = gapi.auth2.init({
        client_id: GOOGLEAPI_CLIENT_ID,
        cookiepolicy: 'single_host_origin',
      });
      googleapiCheck(document.getElementById('googleapiCheckBtn'));
      googleapiCheck(document.getElementById('googleapiGrantBtn'));
      googleapiCheck(document.getElementById('googleapiRevokeBtn'));
    });

    function googleapiCheck(element) {
    auth2.attachClickHandler(element, {},
        function(googleUser) {
            // console.log(googleUser.getBasicProfile());
            var id_token = googleUser.getAuthResponse().id_token;
            var origUrl = $(location).attr('href');
            var pos = origUrl.indexOf("?");
            if (pos != -1) url = origUrl+'&id_token='+id_token;
            else url = origUrl+'?id_token='+id_token;
	    if (element.id == 'googleapiGrantBtn') url += '&action=googleapiGrant';
	    if (element.id == 'googleapiRevokeBtn') url += '&action=googleapiRevoke';
            window.location = url;
        }, function(error) {
          // alert(JSON.stringify(error, undefined, 2));
        });
    }
 }
});
